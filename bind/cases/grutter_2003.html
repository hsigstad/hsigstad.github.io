<!DOCTYPE html>
<html lang="en">
<head>
<meta name="robots" content="noindex, nofollow">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Grutter v. Bollinger — The Binding Force of Law</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css">
<style>
  :root {
    --bg: #f8f9fa; --card: #fff; --fg: #1a1a1a; --muted: #666;
    --border: #dee2e6; --accent: #0d6efd; --accent2: #198754;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: var(--bg); color: var(--fg); line-height: 1.5;
  }

  main {
    padding: 1.5rem 2rem 3rem; max-width: 900px; margin: 0 auto;
  }

  /* Markdown body styles */
  .md-body { font-size: .92rem; line-height: 1.7; color: #1f2328; }

  .md-body h1 { font-size: 1.5rem; font-weight: 600; margin: 1.8rem 0 .8rem; padding-bottom: .3rem; border-bottom: 1px solid var(--border); }
  .md-body h2 { font-size: 1.25rem; font-weight: 600; margin: 1.6rem 0 .6rem; padding-bottom: .25rem; border-bottom: 1px solid var(--border); }
  .md-body h3 { font-size: 1.05rem; font-weight: 600; margin: 1.3rem 0 .5rem; }
  .md-body h4 { font-size: .95rem; font-weight: 600; margin: 1.1rem 0 .4rem; }
  .md-body h5, .md-body h6 { font-size: .88rem; font-weight: 600; margin: 1rem 0 .4rem; }
  .md-body h1:first-child { margin-top: 0; }

  .md-body p { margin: 0 0 .8rem; }

  .md-body ul, .md-body ol { margin: 0 0 .8rem; padding-left: 1.8rem; }
  .md-body li { margin-bottom: .25rem; }
  .md-body li > ul, .md-body li > ol { margin-top: .25rem; margin-bottom: 0; }

  /* Task lists */
  .md-body ul li { list-style: disc; }
  .md-body li input[type="checkbox"] {
    margin-right: .4rem; vertical-align: middle; position: relative; top: -1px;
  }

  .md-body a { color: var(--accent); text-decoration: none; }
  .md-body a:hover { text-decoration: underline; }

  .md-body strong { font-weight: 600; }

  .md-body blockquote {
    margin: 0 0 .8rem; padding: .4rem 1rem;
    border-left: 4px solid var(--accent); background: #f0f4f8;
    color: #555; font-size: .88rem;
  }
  .md-body blockquote p:last-child { margin-bottom: 0; }

  .md-body code {
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: .85em; background: #eef1f5; padding: .15rem .35rem;
    border-radius: 4px;
  }
  .md-body pre {
    margin: 0 0 .8rem; padding: .9rem 1rem;
    background: #f6f8fa; border: 1px solid var(--border);
    border-radius: 6px; overflow-x: auto; line-height: 1.45;
  }
  .md-body pre code {
    background: none; padding: 0; font-size: .82rem;
  }

  .md-body table {
    width: 100%; border-collapse: collapse; margin: 0 0 .8rem;
    font-size: .85rem; display: block; overflow-x: auto;
  }
  .md-body th, .md-body td {
    padding: .45rem .7rem; border: 1px solid var(--border); text-align: left;
  }
  .md-body th { background: #f0f4f8; font-weight: 600; }
  .md-body tr:nth-child(even) td { background: #fafbfc; }

  .md-body hr {
    border: none; border-top: 1px solid var(--border); margin: 1.5rem 0;
  }

  .md-body img { max-width: 100%; }

  /* Collapsible sections */
  .doc-controls { margin-bottom: 1rem; }
  .doc-controls button {
    font-size: .8rem; padding: .3rem .7rem; cursor: pointer;
    background: var(--card); border: 1px solid var(--border); border-radius: 4px;
    color: var(--accent); font-weight: 600;
  }
  .doc-controls button:hover { background: #e7f1ff; }
  .md-body details { margin-bottom: .5rem; }
  .md-body details summary {
    font-weight: 600; cursor: pointer; list-style: none;
  }
  .md-body details summary::-webkit-details-marker { display: none; }
  .md-body details summary::before {
    content: "\25b6"; font-size: .7em; margin-right: .5rem;
    display: inline-block; transition: transform .15s;
  }
  .md-body details[open] summary::before { transform: rotate(90deg); }
  .md-body details.level-2 > summary {
    font-size: 1.25rem; padding-bottom: .25rem;
    border-bottom: 1px solid var(--border); margin: 1.6rem 0 .6rem;
  }
  .md-body details.level-3 > summary {
    font-size: 1.05rem; margin: 1.3rem 0 .5rem;
  }

  footer {
    text-align: center; padding: 1.5rem; font-size: .8rem; color: var(--muted);
    border-top: 1px solid var(--border); margin-top: 2rem;
  }
</style>
</head>
<body>

<style>
  .site-nav {
    position: sticky; top: 0; z-index: 100;
    background: #212529; display: flex; align-items: center;
    padding: 0 2rem; height: 3rem;
  }
  .site-nav .nav-brand {
    color: #fff; text-decoration: none; font-weight: 600; font-size: 1rem;
    margin-right: auto;
  }
  .site-nav .nav-brand:hover { color: #e9ecef; }
  .site-nav .nav-link {
    color: #adb5bd; text-decoration: none; font-size: .85rem;
    padding: 0 .75rem; height: 3rem; display: flex; align-items: center;
    background: none; border: none; cursor: pointer; font-family: inherit;
  }
  .site-nav .nav-link:hover, .site-nav .nav-link.active { color: #fff; }
  .nav-dropdown { position: relative; }
  .dropdown-menu {
    display: none; position: absolute; top: 3rem; right: 0;
    background: #fff; border: 1px solid var(--border); border-radius: 6px;
    box-shadow: 0 4px 16px rgba(0,0,0,.12); min-width: 220px;
    padding: .4rem 0; z-index: 200; max-height: 80vh; overflow-y: auto;
  }
  .nav-dropdown.open .dropdown-menu { display: block; }
  .dropdown-menu a {
    display: block; padding: .3rem 1rem; color: #1a1a1a;
    text-decoration: none; font-size: .82rem;
  }
  .dropdown-menu a:hover { background: #f0f4f8; }
  .dropdown-group-label {
    padding: .4rem 1rem .15rem; font-size: .68rem; font-weight: 700;
    color: #888; text-transform: uppercase; letter-spacing: .04em;
  }
  .dropdown-divider { border-top: 1px solid #eee; margin: .3rem 0; }
  .page-header {
    padding: .8rem 2rem; border-bottom: 1px solid var(--border); background: #fff;
  }
  .page-header h1 { font-size: 1.3rem; font-weight: 600; }
  .page-header p { color: var(--muted); font-size: .85rem; margin-top: .15rem; }
</style>

<nav class="site-nav">
  <a href="../index.html" class="nav-brand">The Binding Force of Law</a>
  <a href="../index.html" class="nav-link">Home</a>
  <a href="../paper/index.html" class="nav-link">Paper</a>
  <div class="nav-dropdown">
    <button class="nav-link">Docs &#9662;</button>
    <div class="dropdown-menu">
    <div class="dropdown-group-label">Reference</div>
    <a href="../docs/summary.html">Research Summary</a>
    <a href="../docs/institutions.html">Institutional Background</a>
    <a href="../docs/data.html">Data & Extractions</a>
    <a href="../docs/methods.html">Formal Model</a>
    <a href="../docs/literature.html">Literature</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Working notes</div>
    <a href="../docs/thinking.html">Open Questions & Ideas</a>
    <a href="../docs/decisions.html">Key Decisions</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Tasks</div>
    <a href="../docs/todo.html">Active Tasks</a>
    <a href="../docs/done.html">Completed Tasks</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Communication</div>
    <a href="../docs/meetings.html">Meeting Notes</a>
    <a href="../docs/feedback.html">External Feedback</a>
    </div>
  </div>
  <div class="nav-dropdown">
    <button class="nav-link">Briefs &#9662;</button>
    <div class="dropdown-menu">
    <a href="../briefs/holding-formalization.html">Decision brief: How to formalize holdings</a>
    <a href="../briefs/paper-status.html">Decision brief: Paper status and path to submission</a>
    </div>
  </div>
  <div class="nav-dropdown">
    <button class="nav-link active">Cases &#9662;</button>
    <div class="dropdown-menu">
    <div class="dropdown-group-label">Equal Protection</div>
    <a href="../cases/carolene_products_1938.html">United States v. Carolene Products Co.</a>
    <a href="../cases/korematsu_1944.html">Korematsu v. United States</a>
    <a href="../cases/brown_v_board_1954.html">Brown v. Board of Education</a>
    <a href="../cases/loving_v_virginia_1967.html">Loving v. Virginia</a>
    <a href="../cases/reed_v_reed_1971.html">Reed v. Reed</a>
    <a href="../cases/craig_v_boren_1976.html">Craig v. Boren</a>
    <a href="../cases/washington_v_davis_1976.html">Washington v. Davis</a>
    <a href="../cases/arlington_heights_1977.html">Village of Arlington Heights v. Metropolitan Housing Development Corp.</a>
    <a href="../cases/feeney_1979.html">Personnel Administrator of Massachusetts v. Feeney</a>
    <a href="../cases/cleburne_1985.html">City of Cleburne v. Cleburne Living Center, Inc.</a>
    <a href="../cases/adarand_1995.html">Adarand Constructors, Inc. v. Pena</a>
    <a href="../cases/romer_v_evans_1996.html">Romer v. Evans</a>
    <a href="../cases/us_v_virginia_vmi_1996.html">United States v. Virginia</a>
    <a href="../cases/grutter_2003.html">Grutter v. Bollinger</a>
    <a href="../cases/parents_involved_2007.html">Parents Involved in Community Schools v. Seattle School District No. 1</a>
    <a href="../cases/fisher_i_2013.html">Fisher v. University of Texas at Austin</a>
    <a href="../cases/fisher_ii_2016.html">Fisher v. University of Texas at Austin</a>
    <a href="../cases/sffa_2023.html">Students for Fair Admissions, Inc. v. President and Fellows of Harvard College</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Due Process</div>
    <a href="../cases/lochner_1905.html">Lochner v. New York</a>
    <a href="../cases/griswold_1965.html">Griswold v. Connecticut</a>
    <a href="../cases/roe_v_wade_1973.html">Roe v. Wade</a>
    <a href="../cases/mathews_v_eldridge_1976.html">Mathews v. Eldridge</a>
    <a href="../cases/casey_1992.html">Planned Parenthood of Southeastern Pennsylvania v. Casey</a>
    <a href="../cases/glucksberg_1997.html">Washington v. Glucksberg</a>
    <a href="../cases/dobbs_2022.html">Dobbs v. Jackson Women's Health Organization</a>
    </div>
  </div>
</nav>
<script>
document.querySelectorAll('.nav-dropdown > .nav-link').forEach(function(btn) {
  btn.addEventListener('click', function(e) {
    e.stopPropagation();
    var dd = btn.parentElement;
    var wasOpen = dd.classList.contains('open');
    document.querySelectorAll('.nav-dropdown.open').forEach(function(d) { d.classList.remove('open'); });
    if (!wasOpen) dd.classList.add('open');
  });
});
document.addEventListener('click', function() {
  document.querySelectorAll('.nav-dropdown.open').forEach(function(d) { d.classList.remove('open'); });
});
</script>

<div class="page-header">
  <h1>Grutter v. Bollinger</h1>
</div>

<main>
<div class="doc-controls">
  <button id="toggle-sections">Expand all</button>
</div>
<div class="md-body">
<h1>Grutter v. Bollinger, 539 U.S. 306 (2003)</h1>
<p><strong>Author:</strong> O'Connor (majority)
<strong>Outcome:</strong> Respondents win ($d = 0$: race-conscious admissions upheld)
<strong>Concurrences:</strong> Ginsburg (joined by Breyer)
<strong>Dissents:</strong> Rehnquist, Scalia (joined by Thomas), Thomas (joined by Scalia), Kennedy</p>
<hr />
<h2 id="1-holding-h-t">1. Holding ($H_t$)</h2>
<blockquote>
<p>&quot;The Law School's narrowly tailored use of race in admissions decisions to further a compelling interest in obtaining the educational benefits that flow from a diverse student body is not prohibited by the Equal Protection Clause, Title VI, or § 1981.&quot; (p. 322-344)</p>
</blockquote>
<p><strong>As constraint on admissible $(w, c)$:</strong> Permits decision rules that consider race as one factor among many in university admissions, provided the use of race is narrowly tailored to achieve the compelling interest of student body diversity. The weight on race must be flexible and individualized, not a quota or automatic determinant.</p>
<p><strong>What the holding does NOT constrain:</strong></p>
<ul>
<li>Specific numerical targets or quotas for minority admissions</li>
<li>Use of race in admissions outside the context of higher education</li>
<li>Duration of permissible race-conscious admissions (Court suggests a 25-year horizon)</li>
<li>Whether race-neutral alternatives must be exhausted</li>
</ul>
<hr />
<h2 id="2-fact-vector-z-t">2. Fact vector $z_t$</h2>
<h3 id="2a-raw-salient-facts">2a. Raw salient facts</h3>
<ul>
<li><strong>Race as a factor in admissions:</strong> The Law School considers race as a &quot;plus&quot; factor in a holistic review of each applicant's file (p. 317). Favors: government.</li>
<li><strong>Critical mass concept:</strong> The Law School aims to enroll a &quot;critical mass&quot; of underrepresented minority students to achieve diversity benefits (p. 330). Favors: government.</li>
<li><strong>Individualized review:</strong> Admissions decisions are based on a flexible, individualized review of each applicant (p. 337). Favors: government.</li>
<li><strong>Educational benefits of diversity:</strong> Diversity is said to promote cross-racial understanding and break down stereotypes (p. 330). Favors: government.</li>
<li><strong>No quotas:</strong> The Law School's program does not use quotas or separate admissions tracks for minority students (p. 334). Favors: government.</li>
<li><strong>Race-neutral alternatives considered:</strong> The Law School considered but rejected race-neutral alternatives as insufficient to achieve diversity (p. 339). Favors: government.</li>
</ul>
<h3 id="2b-dimension-mapping">2b. Dimension mapping</h3>
<table>
<thead>
<tr>
  <th>Dimension</th>
  <th>Value</th>
  <th>Raw fact(s) mapped</th>
  <th>Textual basis</th>
</tr>
</thead>
<tbody>
<tr>
  <td>D1 Facial classification</td>
  <td>High</td>
  <td>Race as a factor in admissions</td>
  <td>&quot;Race as a 'plus' factor&quot; (p. 317)</td>
</tr>
<tr>
  <td>D2 Protected trait</td>
  <td>Race</td>
  <td>Race as a factor in admissions</td>
  <td>Throughout</td>
</tr>
<tr>
  <td>D3 Intent evidence</td>
  <td>High</td>
  <td>Critical mass concept</td>
  <td>&quot;aims to enroll a 'critical mass'&quot; (p. 330)</td>
</tr>
<tr>
  <td>D4 Interest strength</td>
  <td>Compelling</td>
  <td>Educational benefits of diversity</td>
  <td>&quot;compelling interest in obtaining... benefits&quot; (p. 322)</td>
</tr>
<tr>
  <td>D5 Means-ends fit</td>
  <td>Tight</td>
  <td>Individualized review; no quotas</td>
  <td>&quot;flexible, individualized review&quot; (p. 337); &quot;no quotas&quot; (p. 334)</td>
</tr>
<tr>
  <td>D6 Stigma / caste</td>
  <td>Low</td>
  <td>Educational benefits of diversity</td>
  <td>&quot;break down stereotypes&quot; (p. 330)</td>
</tr>
<tr>
  <td>D7 Institutional setting</td>
  <td>Higher education</td>
  <td>Context of university admissions</td>
  <td>&quot;context of higher education&quot; (p. 328)</td>
</tr>
<tr>
  <td>D8 Precedent density</td>
  <td>High conflict</td>
  <td>Reference to Bakke and subsequent cases</td>
  <td>&quot;Justice Powell's opinion... as the touchstone&quot; (p. 322)</td>
</tr>
</tbody>
</table>
<p><strong>Unmapped facts:</strong></p>
<ul>
<li><em>Race-neutral alternatives considered</em> does not map directly to any existing dimension. It reflects the Court's consideration of alternatives in assessing narrow tailoring, suggesting a potential dimension for the sufficiency of race-neutral measures.</li>
</ul>
<p><strong>Notable:</strong> The Court emphasizes the importance of individualized consideration and rejects any form of racial balancing or quotas, highlighting the nuanced approach required in applying strict scrutiny to race-conscious admissions.</p>
<hr />
<h2 id="3-treatment-of-prior-holdings-mathcal-f-t-update">3. Treatment of prior holdings ($\mathcal{F}_t$ update)</h2>
<h3 id="regents-of-univ-of-cal-v-bakke-1978">Regents of Univ. of Cal. v. Bakke (1978)</h3>
<ul>
<li><strong>Status:</strong> Endorsed. The Court adopts Justice Powell's view that student body diversity is a compelling interest.</li>
<li><strong>Characterization:</strong> Powell's opinion is described as the &quot;touchstone&quot; for constitutional analysis of race-conscious admissions policies (p. 322).</li>
<li><strong>Model interpretation:</strong> Reinforces the constraint that diversity can be a compelling interest, but requires narrow tailoring and individualized consideration.</li>
</ul>
<h3 id="adarand-constructors-inc-v-pe-a-1995">Adarand Constructors, Inc. v. Peña (1995)</h3>
<ul>
<li><strong>Status:</strong> Relied on. The Court reaffirms the application of strict scrutiny to all racial classifications.</li>
<li><strong>Characterization:</strong> Emphasizes that strict scrutiny is not &quot;strict in theory, but fatal in fact&quot; (p. 326).</li>
<li><strong>Model interpretation:</strong> Confirms the need for a compelling interest and narrow tailoring in race-based governmental actions.</li>
</ul>
<h3 id="richmond-v-j-a-croson-co-1989">Richmond v. J. A. Croson Co. (1989)</h3>
<ul>
<li><strong>Status:</strong> Relied on. The Court cites Croson to underscore the need for narrow tailoring.</li>
<li><strong>Characterization:</strong> Highlights the requirement that race-based measures must be justified by a compelling interest (p. 326).</li>
<li><strong>Model interpretation:</strong> Supports the framework for evaluating race-conscious policies under strict scrutiny.</li>
</ul>
<hr />
<h2 id="4-overruling-constraint-removal-at-cost-c">4. Overruling (constraint removal at cost $C$)</h2>
<p>No overruling in this case. The Court explicitly endorses Justice Powell's diversity rationale from Bakke and applies it to the context of university admissions. The Court does not remove any existing constraints but clarifies the application of strict scrutiny to race-conscious admissions policies.</p>
<hr />
<h2 id="5-breadth">5. Breadth</h2>
<p><strong>Narrow reading (what the Court explicitly holds):</strong></p>
<ul>
<li>Race can be considered as one factor among many in university admissions to achieve the educational benefits of diversity.</li>
<li>The use of race must be narrowly tailored and cannot involve quotas or racial balancing.</li>
</ul>
<p><strong>Broad reading (what the reasoning supports):</strong></p>
<ul>
<li>The decision supports the use of race-conscious admissions in higher education more broadly, provided the criteria of narrow tailoring and compelling interest are met.</li>
<li>The reasoning could extend to other contexts where diversity is deemed essential to an institution's mission.</li>
</ul>
<p><strong>Breadth ambiguity:</strong>
The Court's decision leaves open questions about the precise limits of permissible race-conscious admissions, particularly regarding the duration of such policies and the specific metrics for achieving &quot;critical mass.&quot;</p>
<hr />
<h2 id="6-concurrences-dissents-alternative-admissible-theories">6. Concurrences / dissents (alternative admissible theories)</h2>
<h3 id="ginsburg-joined-by-breyer">Ginsburg (joined by Breyer)</h3>
<ul>
<li><strong>Alternative constraint structure:</strong> Supports the majority but emphasizes the temporary nature of race-conscious measures, aligning with international norms on affirmative action.</li>
<li><strong>Key disagreement:</strong> None; concurs with the majority's framework.</li>
</ul>
<h3 id="rehnquist-joined-by-scalia-kennedy-thomas">Rehnquist (joined by Scalia, Kennedy, Thomas)</h3>
<ul>
<li><strong>Alternative constraint structure:</strong> Would impose stricter limits on the use of race, viewing the Law School's policy as a form of racial balancing.</li>
<li><strong>Key disagreement:</strong> D5 Means-ends fit; argues the policy is not narrowly tailored and amounts to racial balancing.</li>
</ul>
<h3 id="scalia-joined-by-thomas">Scalia (joined by Thomas)</h3>
<ul>
<li><strong>Alternative constraint structure:</strong> Criticizes the majority for undermining strict scrutiny and perpetuating racial discrimination.</li>
<li><strong>Key disagreement:</strong> D4 Interest strength; questions the compelling nature of diversity as an interest.</li>
</ul>
<h3 id="thomas-joined-by-scalia">Thomas (joined by Scalia)</h3>
<ul>
<li><strong>Alternative constraint structure:</strong> Argues against any use of race in admissions, emphasizing a colorblind interpretation of the Constitution.</li>
<li><strong>Key disagreement:</strong> D1 Facial classification, D4 Interest strength; opposes race as a factor and questions the legitimacy of diversity as a compelling interest.</li>
</ul>
<h3 id="kennedy">Kennedy</h3>
<ul>
<li><strong>Alternative constraint structure:</strong> Supports the use of race as a factor but criticizes the majority for not applying strict scrutiny rigorously.</li>
<li><strong>Key disagreement:</strong> D5 Means-ends fit; argues the policy lacks individualized consideration and amounts to racial balancing.</li>
</ul>
<hr />
<h2 id="7-reasoning-revealing-implicit-weights-on-dimensions">7. Reasoning revealing implicit weights on dimensions</h2>
<p><strong>Deference to educational judgment (D7 weight is high):</strong></p>
<blockquote>
<p>&quot;The Law School's educational judgment that such diversity is essential to its educational mission is one to which we defer.&quot; (p. 328)</p>
</blockquote>
<p>The Court places significant weight on the institutional setting, deferring to the Law School's judgment about the benefits of diversity.</p>
<p><strong>Importance of individualized review (D5 weight is high):</strong></p>
<blockquote>
<p>&quot;The Law School engages in a highly individualized, holistic review of each applicant's file.&quot; (p. 337)</p>
</blockquote>
<p>The Court emphasizes the need for a tight means-ends fit, requiring individualized consideration in admissions decisions.</p>
<p><strong>Compelling interest in diversity (D4 weight is high):</strong></p>
<blockquote>
<p>&quot;The Law School has a compelling interest in attaining a diverse student body.&quot; (p. 333)</p>
</blockquote>
<p>The Court affirms the strength of the interest in diversity, supporting its status as a compelling governmental interest.</p>
<p><strong>Rejection of quotas (D5 weight is high):</strong></p>
<blockquote>
<p>&quot;The Law School's admissions program... does not operate as a quota.&quot; (p. 334)</p>
</blockquote>
<p>The Court underscores the importance of avoiding quotas, reinforcing the requirement for narrow tailoring in race-conscious admissions.</p>

</div>
</main>

<footer>
  Generated by <code>python3 -m source.site.build_all</code>
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const body = document.querySelector('.md-body');
  if (!body) return;

  function foldHeadings(container, tag) {
    const level = tag.replace('H', '');
    const headings = Array.from(container.querySelectorAll(':scope > ' + tag.toLowerCase()));
    headings.forEach(h => {
      const details = document.createElement('details');
      details.className = 'level-' + level;
      if (h.id) details.id = h.id;
      const summary = document.createElement('summary');
      summary.innerHTML = h.innerHTML;
      details.appendChild(summary);
      let sibling = h.nextElementSibling;
      const collected = [];
      while (sibling && sibling.tagName !== tag) {
        collected.push(sibling);
        sibling = sibling.nextElementSibling;
      }
      collected.forEach(el => details.appendChild(el));
      h.replaceWith(details);
    });
    return headings.length;
  }

  // Fold h2 sections, then h3 sections within each h2
  const count = foldHeadings(body, 'H2');
  if (count === 0) {
    document.querySelector('.doc-controls').style.display = 'none';
    return;
  }
  body.querySelectorAll('details.level-2').forEach(d => foldHeadings(d, 'H3'));

  // Toggle button
  const btn = document.getElementById('toggle-sections');
  if (!btn) return;
  btn.addEventListener('click', () => {
    const allDetails = body.querySelectorAll('details');
    const expanding = btn.textContent === 'Expand all';
    allDetails.forEach(d => d.open = expanding);
    btn.textContent = expanding ? 'Collapse all' : 'Expand all';
  });

  // Auto-open details when navigating to an anchor
  function openAnchorTarget() {
    if (!location.hash) return;
    const target = document.querySelector(location.hash);
    if (!target) return;
    let el = target;
    while (el) {
      if (el.tagName === 'DETAILS') el.open = true;
      el = el.parentElement;
    }
    target.scrollIntoView();
  }
  openAnchorTarget();
  window.addEventListener('hashchange', openAnchorTarget);
});
</script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js"
  onload="renderMathInElement(document.querySelector('.md-body'), {
    delimiters: [
      {left: '$$', right: '$$', display: true},
      {left: '$', right: '$', display: false}
    ],
    throwOnError: false
  });"></script>
</body>
</html>
