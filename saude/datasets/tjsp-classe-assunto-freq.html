<!DOCTYPE html>
<html lang="en">
<head>
<meta name="robots" content="noindex, nofollow">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TJSP Sentença Class × Subject Frequencies</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<style>
  :root {
    --bg: #f8f9fa; --card: #fff; --fg: #1a1a1a; --muted: #666;
    --border: #dee2e6; --accent: #0d6efd; --accent2: #198754;
    --accent3: #dc3545; --accent4: #fd7e14;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: var(--bg); color: var(--fg); line-height: 1.5;
  }

  .stats-bar {
    display: flex; gap: .8rem; padding: 1rem 2rem; flex-wrap: wrap;
  }
  .stat-card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 8px; padding: .75rem 1rem; flex: 1; min-width: 120px;
    text-align: center;
  }
  .stat-card .value { font-size: 1.5rem; font-weight: 700; color: var(--accent); }
  .stat-card .label { font-size: .72rem; color: var(--muted); text-transform: uppercase; letter-spacing: .04em; }

  main { padding: 0 2rem 3rem; max-width: 1400px; margin: 0 auto; }

  h2.section-title {
    font-size: 1.15rem; margin: 1.6rem 0 .8rem; padding-bottom: .3rem;
    border-bottom: 2px solid var(--border);
  }

  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.2rem; }
  @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

  .card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 8px; padding: 1.2rem 1.4rem;
  }
  .card h3 { font-size: .95rem; margin-bottom: .8rem; color: var(--fg); }
  .card.full { grid-column: 1 / -1; }

  .chart-wrap { position: relative; width: 100%; }
  .chart-wrap.bar { height: 300px; }
  .chart-wrap.hbar { height: 380px; }

  /* column info table */
  .col-table { width: 100%; border-collapse: collapse; font-size: .82rem; }
  .col-table th, .col-table td {
    padding: .35rem .6rem; border-bottom: 1px solid var(--border); text-align: left;
  }
  .col-table th { background: #f0f4f8; font-weight: 600; position: sticky; top: 0; }
  .col-table .null-bar { display: inline-block; height: 10px; border-radius: 2px; background: #dc3545; }

  /* data table */
  .table-wrap { overflow-x: auto; max-height: 520px; overflow-y: auto; }
  .data-table { width: 100%; border-collapse: collapse; font-size: .8rem; }
  .data-table th, .data-table td {
    padding: .4rem .5rem; border-bottom: 1px solid var(--border);
    text-align: left; white-space: nowrap; max-width: 250px; overflow: hidden; text-overflow: ellipsis;
  }
  .data-table th { position: sticky; top: 0; background: #f0f4f8; font-weight: 600; }
  .data-table tbody tr:hover { background: #f0f4ff; }

  .search-bar { margin-bottom: .8rem; }
  .search-bar input {
    font-size: .85rem; padding: .4rem .7rem; border: 1px solid var(--border);
    border-radius: 4px; width: 100%; max-width: 400px;
  }
  .count-label { font-size: .8rem; color: var(--muted); margin-left: .8rem; }

  footer {
    text-align: center; padding: 1.5rem; font-size: .8rem; color: var(--muted);
    border-top: 1px solid var(--border); margin-top: 2rem;
  }
</style>
</head>
<body>

<style>
  .site-nav {
    position: sticky; top: 0; z-index: 100;
    background: #212529; display: flex; align-items: center;
    padding: 0 2rem; height: 3rem;
  }
  .site-nav .nav-brand {
    color: #fff; text-decoration: none; font-weight: 600; font-size: 1rem;
    margin-right: auto;
  }
  .site-nav .nav-brand:hover { color: #e9ecef; }
  .site-nav .nav-link {
    color: #adb5bd; text-decoration: none; font-size: .85rem;
    padding: 0 .75rem; height: 3rem; display: flex; align-items: center;
    background: none; border: none; cursor: pointer; font-family: inherit;
  }
  .site-nav .nav-link:hover, .site-nav .nav-link.active { color: #fff; }
  .nav-dropdown { position: relative; }
  .dropdown-menu {
    display: none; position: absolute; top: 3rem; right: 0;
    background: #fff; border: 1px solid var(--border); border-radius: 6px;
    box-shadow: 0 4px 16px rgba(0,0,0,.12); min-width: 220px;
    padding: .4rem 0; z-index: 200; max-height: 80vh; overflow-y: auto;
  }
  .nav-dropdown.open .dropdown-menu { display: block; }
  .dropdown-menu a {
    display: block; padding: .3rem 1rem; color: #1a1a1a;
    text-decoration: none; font-size: .82rem;
  }
  .dropdown-menu a:hover { background: #f0f4f8; }
  .dropdown-group-label {
    padding: .4rem 1rem .15rem; font-size: .68rem; font-weight: 700;
    color: #888; text-transform: uppercase; letter-spacing: .04em;
  }
  .dropdown-divider { border-top: 1px solid #eee; margin: .3rem 0; }
  .page-header {
    padding: .8rem 2rem; border-bottom: 1px solid var(--border); background: #fff;
  }
  .page-header h1 { font-size: 1.3rem; font-weight: 600; }
  .page-header p { color: var(--muted); font-size: .85rem; margin-top: .15rem; }
</style>

<nav class="site-nav">
  <a href="../index.html" class="nav-brand">Judicialização da Saúde</a>
  <a href="../paper/index.html" class="nav-link">Paper</a>
  <div class="nav-dropdown">
    <button class="nav-link">Docs &#9662;</button>
    <div class="dropdown-menu">
    <div class="dropdown-group-label">Research reference</div>
    <a href="../docs/README.html">Project Overview</a>
    <a href="../docs/summary.html">Research Summary</a>
    <a href="../docs/institutions.html">Institutional Background</a>
    <a href="../docs/data.html">Data Sources</a>
    <a href="../docs/methods.html">Empirical Methods</a>
    <a href="../docs/literature.html">Literature</a>
    <a href="../docs/theory.html">Theoretical Framework</a>
    <a href="../docs/hypotheses.html">Hypotheses & Evidence</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Working notes</div>
    <a href="../docs/thinking.html">Open Questions & Ideas</a>
    <a href="../docs/decisions.html">Key Decisions</a>
    <a href="../docs/qa.html">Research Q&A</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Task tracking</div>
    <a href="../docs/todo.html">Active Tasks</a>
    <a href="../docs/done.html">Completed Tasks</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Communication</div>
    <a href="../docs/meetings.html">Meeting Notes</a>
    <a href="../docs/feedback.html">External Feedback</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Court analysis</div>
    <a href="../docs/01-stf-reasoning-templates.html">STF Reasoning Templates</a>
    <a href="../docs/02-stj-repetitivos-patterns.html">STJ Repetitivos Patterns</a>
    <a href="../docs/03-tjsp-plans-vs-sus.html">TJSP: Plans vs SUS</a>
    <a href="../docs/04-conitec-pcdt-vs-courts.html">CONITEC vs Courts</a>
    <a href="../docs/05-interfederative-responsibility.html">Interfederative Responsibility</a>
    </div>
  </div>
  <div class="nav-dropdown">
    <button class="nav-link active">Data &#9662;</button>
    <div class="dropdown-menu">
    <a href="../sources/tjsp.html">TJSP</a>
    <a href="../sources/datajud.html">DataJud</a>
    <a href="../sources/stf-stj.html">STF & STJ</a>
    <a href="../sources/trf3.html">TRF3</a>
    <a href="../sources/spending.html">Municipal Spending</a>
    <a href="../sources/legislation.html">Health Legislation</a>
    </div>
  </div>
  <a href="../references/index.html" class="nav-link">References</a>
  <a href="../news/index.html" class="nav-link">News</a>
</nav>
<script>
document.querySelectorAll('.nav-dropdown > .nav-link').forEach(function(btn) {
  btn.addEventListener('click', function(e) {
    e.stopPropagation();
    var dd = btn.parentElement;
    var wasOpen = dd.classList.contains('open');
    document.querySelectorAll('.nav-dropdown.open').forEach(function(d) { d.classList.remove('open'); });
    if (!wasOpen) dd.classList.add('open');
  });
});
document.addEventListener('click', function() {
  document.querySelectorAll('.nav-dropdown.open').forEach(function(d) { d.classList.remove('open'); });
});
</script>

<div class="page-header">
  <h1>TJSP Sentença Class × Subject Frequencies</h1>
  <p>Cross-tabulation of procedural classes and legal subjects in TJSP first-instance rulings.</p>
</div>

<div class="stats-bar" id="stats-bar"></div>

<main>

<!-- Data source notes -->
<div id="source-notes-section"></div>

<!-- Column info -->
<h2 class="section-title">Column Information</h2>
<div class="card full">
  <div style="overflow-x:auto; max-height:400px; overflow-y:auto;">
    <table class="col-table" id="col-table"></table>
  </div>
</div>

<!-- Distribution charts -->
<div id="dist-section"></div>

<!-- Temporal charts -->
<div id="temporal-section"></div>

<!-- Sample data -->
<h2 class="section-title">Sample Data (50 rows)</h2>
<div class="card full">
  <div class="search-bar">
    <input type="text" id="search" placeholder="Search across all columns...">
    <span class="count-label" id="row-count"></span>
  </div>
  <div class="table-wrap">
    <table class="data-table">
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

</main>

<footer>
  Generated by <code>bash build.sh site</code>
</footer>

<script>
// ═══════════════════════════════════════════════════════════════
//  Embedded data — replaced by build pipeline
// ═══════════════════════════════════════════════════════════════
const DATA = /* INJECT_DATA */ {"id":"tjsp-classe-assunto-freq","name":"TJSP Sentença Class × Subject Frequencies","description":"Cross-tabulation of procedural classes and legal subjects in TJSP first-instance rulings.","category":"TJSP Sentença","source_notes":"Cross-tabulation showing how procedural classes and legal subjects co-occur in TJSP first-instance cases. Covers all subjects, not just health. Useful for understanding which procedural vehicles are used for health litigation (e.g., most health cases use Procedimento Comum Cível or Mandado de Segurança).","file_size":1982375,"row_count":28365,"col_count":5,"columns":[{"name":"classe","dtype":"object","null_count":0,"null_pct":0.0},{"name":"assunto","dtype":"object","null_count":0,"null_pct":0.0},{"name":"count","dtype":"int64","null_count":0,"null_pct":0.0},{"name":"pct","dtype":"float64","null_count":0,"null_pct":0.0},{"name":"cum_pct","dtype":"float64","null_count":0,"null_pct":0.0}],"categorical":{"classe":{"labels":["Cumprimento de sentença","Procedimento Comum Cível","(vazio)","Procedimento Comum","Procedimento do Juizado Especial Cível","Cumprimento de Sentença contra a Fazenda Pública","Requisição de Pequeno Valor","Cumprimento Provisório de Sentença","Procedimento do Juizado Especial da Fazenda Pública","Mandado de Segurança Cível","Mandado de Segurança","Cumprimento Provisório de Decisão","Precatório","Ação Penal - Procedimento Ordinário","Reclamação Pré-processual","Ação Civil Pública","Embargos à Execução","Execução de Título Extrajudicial","Inquérito Policial","Liquidação de Sentença pelo Procedimento Comum"],"values":[1282,1238,1129,1039,921,891,860,720,685,594,566,495,468,428,414,413,395,394,353,348]},"assunto":{"labels":["Assunto não informado.","DIREITO CIVIL","Obrigações","Obrigação de Fazer / Não Fazer","Liminar","Espécies de Contratos","Liquidação / Cumprimento / Execução","DIREITO PROCESSUAL CIVIL E DO TRABALHO","Indenização por Dano Moral","Defeito, nulidade ou anulação","Família","Pagamento","Antecipação de Tutela / Tutela Específica","Prestação de Serviços","Compra e Venda","Indenização por Dano Material","Inventário e Partilha","Contratos Bancários","Valor da Execução / Cálculo / Atualização","Propriedade"],"values":[156,136,134,128,127,108,106,104,101,97,97,92,88,87,85,85,83,83,82,80]}},"temporal":{},"sample_columns":["classe","assunto","count","pct","cum_pct"],"sample":[["Procedimento Investigatório Criminal (PIC-MP)","Concussão","2","0.0","95.62"],["Requisição de Pequeno Valor","Responsabilidade fiscal","7","0.0","95.62"],["Ação Civil Pública","Nulidade / Anulação","1","0.0","95.62"],["Ação Penal - Procedimento Ordinário","Fuga de pessoa presa ou submetida a medida de segurança","58","0.0","95.62"],["Cumprimento Provisório de Decisão","Limite de Idade","1","0.0","95.62"],["Liquidação de Sentença pelo Procedimento Comum","Pagamento","28","0.0","95.62"],["Procedimento Comum","Repetição de indébito","17481","0.06","76.08"],["Cumprimento de sentença","Doação","164","0.0","95.62"],["Reclamação Pré-processual","Ajuda de Custo","2","0.0","95.62"],["Alvará Judicial - Lei 6858/80","Apuração de haveres","15","0.0","95.62"],["Representação Criminal/Notícia de Crime","Crimes Previstos no Estatuto do Idoso","7","0.0","95.62"],["Ação Civil Pública","Apuração de haveres","1","0.0","95.62"],["Reclamação Pré-processual","Nota de Crédito Industrial","2","0.0","95.62"],["Produção Antecipada da Prova","Inventário e Partilha","3","0.0","95.62"],["Cumprimento de Sentença contra a Fazenda Pública","Cláusula Penal","2","0.0","95.62"],["Busca e Apreensão em Alienação Fiduciária","Depósito Judicial","1","0.0","95.62"],["Retificação ou Suprimento ou Restauração de Registro Civil","Atos Unilaterais","3","0.0","95.62"],["Interdição/Curatela","Direito de Preferência","2","0.0","95.62"],["Dúvida","Registro de Óbito após prazo legal","7","0.0","95.62"],["Procedimento do Juizado Especial Cível","Exigência de Prática Forense","1","0.0","95.62"],["Pedido de Busca e Apreensão Criminal","Decorrente de Violência Doméstica","1","0.0","95.62"],["Pedido de Providências","Habeas Corpus - Cabimento","1","0.0","95.62"],["Incidente de Suspeição Cível","Meio Ambiente","1","0.0","95.62"],["Procedimento Comum Cível","Assunto não Especificado","27","0.0","95.62"],["Interdição/Curatela","Cumprimento Provisório de Sentença","5","0.0","95.62"],["Precatório","Auxílio-transporte","4","0.0","95.62"],["Alienação Judicial de Bens","Compra e Venda","11","0.0","95.62"],["Liquidação Provisória de Sentença pelo Procedimento Comum","Aposentadoria por Invalidez","6","0.0","95.62"],["Interpelação","DIREITO PREVIDENCIÁRIO","1","0.0","95.62"],["Mandado de Segurança Cível","Mineração","2","0.0","95.62"],["Requisição de Pequeno Valor","Fauna","2","0.0","95.62"],["Execução Provisória","Pena Restritiva de Direitos","102","0.0","95.62"],["Mandado de Segurança","Salário-Família","1","0.0","95.62"],["Procedimento Especial da Lei Antitóxicos","Falsificação de documento público","5","0.0","95.62"],["Liquidação de Sentença pelo Procedimento Comum","Promessa de Compra e Venda","12","0.0","95.62"],["Reabilitação","Taxas","1","0.0","95.62"],["Mandado de Segurança","Habitação","8","0.0","95.62"],["Cumprimento de sentença","Cabimento","26","0.0","95.62"],["Boletim de Ocorrência Circunstanciada","Leve","8","0.0","95.62"],["Cautelar Inominada","Fornecimento de Medicamentos","4","0.0","95.62"],["Outros procedimentos de jurisdição voluntária","ALVARÁ","9","0.0","95.62"],["Cumprimento de Sentença contra a Fazenda Pública","Renúncia ao benefício","26","0.0","95.62"],["Cumprimento de Sentença contra a Fazenda Pública","Salário-Maternidade","18","0.0","95.62"],["Reintegração / Manutenção de Posse","Liquidação / Cumprimento / Execução","22","0.0","95.62"],["Reclamação Pré-processual","Pulsos Excedentes","2","0.0","95.62"],["Procedimento do Juizado Especial Cível","Cédula de Crédito Industrial","8","0.0","95.62"],["Procedimento de Repactuação de Dívidas (Superendividamento)","Confissão/Composição de Dívida","2","0.0","95.62"],["Ação Penal - Procedimento Ordinário","Crimes Praticados por Particular Contra a Administração Pública Estrangeira","1","0.0","95.62"],["Impugnação ao Valor da Causa Cível","Obrigação de Fazer / Não Fazer","2","0.0","95.62"],["Execução de Título Judicial","Prestação de Serviços","5","0.0","95.62"]]};

// ═══════════════════════════════════════════════════════════════
//  Helpers
// ═══════════════════════════════════════════════════════════════
const pal = ['#0d6efd','#198754','#dc3545','#fd7e14','#6f42c1','#20c997',
             '#0dcaf0','#d63384','#ffc107','#6610f2','#adb5bd','#e85d04',
             '#2b9348','#4361ee','#f72585'];
function fmtNum(n) { return n.toLocaleString('en'); }
function fmtSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / 1048576).toFixed(1) + ' MB';
}

// ═══════════════════════════════════════════════════════════════
//  Data source notes
// ═══════════════════════════════════════════════════════════════
(function() {
  if (!DATA.source_notes) return;
  const section = document.getElementById('source-notes-section');
  const h2 = document.createElement('h2');
  h2.className = 'section-title';
  h2.textContent = 'About This Dataset';
  section.appendChild(h2);
  const card = document.createElement('div');
  card.className = 'card full';
  card.innerHTML = '<p style="font-size:.9rem;line-height:1.7;color:#333">' + DATA.source_notes + '</p>';
  section.appendChild(card);
})();

// ═══════════════════════════════════════════════════════════════
//  Stats bar
// ═══════════════════════════════════════════════════════════════
(function() {
  const bar = document.getElementById('stats-bar');
  const items = [
    ['Rows', fmtNum(DATA.row_count)],
    ['Columns', fmtNum(DATA.col_count)],
    ['File Size', fmtSize(DATA.file_size)],
  ];
  // Add temporal ranges
  Object.entries(DATA.temporal || {}).forEach(([col, t]) => {
    items.push(['Date Range (' + col + ')', t.min + ' to ' + t.max]);
  });
  items.forEach(([label, value]) => {
    const d = document.createElement('div');
    d.className = 'stat-card';
    d.innerHTML = '<div class="value">' + value + '</div><div class="label">' + label + '</div>';
    bar.appendChild(d);
  });
})();

// ═══════════════════════════════════════════════════════════════
//  Column info table
// ═══════════════════════════════════════════════════════════════
(function() {
  const table = document.getElementById('col-table');
  let html = '<thead><tr><th>#</th><th>Column</th><th>Type</th><th>Nulls</th><th>Null %</th></tr></thead><tbody>';
  DATA.columns.forEach((c, i) => {
    const barW = Math.min(c.null_pct, 100);
    html += '<tr><td>' + (i + 1) + '</td><td><strong>' + c.name + '</strong></td>'
      + '<td>' + c.dtype + '</td>'
      + '<td>' + fmtNum(c.null_count) + '</td>'
      + '<td><span class="null-bar" style="width:' + barW + 'px"></span> ' + c.null_pct + '%</td></tr>';
  });
  html += '</tbody>';
  table.innerHTML = html;
})();

// ═══════════════════════════════════════════════════════════════
//  Categorical distribution charts
// ═══════════════════════════════════════════════════════════════
(function() {
  const section = document.getElementById('dist-section');
  const cats = Object.entries(DATA.categorical || {});
  if (cats.length === 0) return;

  const h2 = document.createElement('h2');
  h2.className = 'section-title';
  h2.textContent = 'Categorical Distributions (Top 15)';
  section.appendChild(h2);

  const grid = document.createElement('div');
  grid.className = 'grid';
  section.appendChild(grid);

  cats.forEach(([col, d], idx) => {
    const card = document.createElement('div');
    card.className = 'card';
    const labels = d.labels.map(s => String(s).length > 40 ? String(s).slice(0, 38) + '\u2026' : String(s));
    card.innerHTML = '<h3>' + col + '</h3><div class="chart-wrap hbar"><canvas id="cat-' + idx + '"></canvas></div>';
    grid.appendChild(card);

    // Render after DOM insertion
    setTimeout(() => {
      new Chart(document.getElementById('cat-' + idx), {
        type: 'bar',
        data: { labels: labels, datasets: [{ data: d.values, backgroundColor: pal[idx % pal.length] }] },
        options: {
          indexAxis: 'y', responsive: true, maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { x: { beginAtZero: true } }
        }
      });
    }, 0);
  });
})();

// ═══════════════════════════════════════════════════════════════
//  Temporal charts
// ═══════════════════════════════════════════════════════════════
(function() {
  const section = document.getElementById('temporal-section');
  const temps = Object.entries(DATA.temporal || {});
  if (temps.length === 0) return;

  const h2 = document.createElement('h2');
  h2.className = 'section-title';
  h2.textContent = 'Temporal Distribution';
  section.appendChild(h2);

  const grid = document.createElement('div');
  grid.className = 'grid';
  section.appendChild(grid);

  temps.forEach(([col, t], idx) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = '<h3>' + col + ' by year</h3><div class="chart-wrap bar"><canvas id="temp-' + idx + '"></canvas></div>';
    grid.appendChild(card);

    setTimeout(() => {
      new Chart(document.getElementById('temp-' + idx), {
        type: 'bar',
        data: {
          labels: t.by_year.labels,
          datasets: [{ label: 'Count', data: t.by_year.values, backgroundColor: '#0d6efd' }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }, 0);
  });
})();

// ═══════════════════════════════════════════════════════════════
//  Sample data table
// ═══════════════════════════════════════════════════════════════
const allRows = DATA.sample || [];
const sampleCols = DATA.sample_columns || [];

(function() {
  document.getElementById('thead').innerHTML = '<tr>' + sampleCols.map(c => '<th>' + c + '</th>').join('') + '</tr>';
  const searchEl = document.getElementById('search');
  const countEl = document.getElementById('row-count');
  const tbody = document.getElementById('tbody');

  function render() {
    const q = searchEl.value.toLowerCase();
    const rows = q ? allRows.filter(r => r.some(v => String(v).toLowerCase().includes(q))) : allRows;
    tbody.innerHTML = rows.map(r =>
      '<tr>' + r.map(v => '<td>' + v + '</td>').join('') + '</tr>'
    ).join('');
    countEl.textContent = rows.length + ' of ' + allRows.length + ' rows';
  }
  searchEl.addEventListener('input', render);
  render();
})();
</script>
</body>
</html>
