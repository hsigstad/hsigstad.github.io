<!DOCTYPE html>
<html lang="en">
<head>
<meta name="robots" content="noindex, nofollow">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TCE-SP Fiscal Alerts</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<style>
  :root {
    --bg: #f8f9fa; --card: #fff; --fg: #1a1a1a; --muted: #666;
    --border: #dee2e6; --accent: #0d6efd; --accent2: #198754;
    --accent3: #dc3545; --accent4: #fd7e14;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: var(--bg); color: var(--fg); line-height: 1.5;
  }

  .stats-bar {
    display: flex; gap: .8rem; padding: 1rem 2rem; flex-wrap: wrap;
  }
  .stat-card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 8px; padding: .75rem 1rem; flex: 1; min-width: 120px;
    text-align: center;
  }
  .stat-card .value { font-size: 1.5rem; font-weight: 700; color: var(--accent); }
  .stat-card .label { font-size: .72rem; color: var(--muted); text-transform: uppercase; letter-spacing: .04em; }

  main { padding: 0 2rem 3rem; max-width: 1400px; margin: 0 auto; }

  h2.section-title {
    font-size: 1.15rem; margin: 1.6rem 0 .8rem; padding-bottom: .3rem;
    border-bottom: 2px solid var(--border);
  }

  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.2rem; }
  @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

  .card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 8px; padding: 1.2rem 1.4rem;
  }
  .card h3 { font-size: .95rem; margin-bottom: .8rem; color: var(--fg); }
  .card.full { grid-column: 1 / -1; }

  .chart-wrap { position: relative; width: 100%; }
  .chart-wrap.bar { height: 300px; }
  .chart-wrap.hbar { height: 380px; }

  /* column info table */
  .col-table { width: 100%; border-collapse: collapse; font-size: .82rem; }
  .col-table th, .col-table td {
    padding: .35rem .6rem; border-bottom: 1px solid var(--border); text-align: left;
  }
  .col-table th { background: #f0f4f8; font-weight: 600; position: sticky; top: 0; }
  .col-table .null-bar { display: inline-block; height: 10px; border-radius: 2px; background: #dc3545; }

  /* data table */
  .table-wrap { overflow-x: auto; max-height: 520px; overflow-y: auto; }
  .data-table { width: 100%; border-collapse: collapse; font-size: .8rem; }
  .data-table th, .data-table td {
    padding: .4rem .5rem; border-bottom: 1px solid var(--border);
    text-align: left; white-space: nowrap; max-width: 250px; overflow: hidden; text-overflow: ellipsis;
  }
  .data-table th { position: sticky; top: 0; background: #f0f4f8; font-weight: 600; }
  .data-table tbody tr:hover { background: #f0f4ff; }

  .search-bar { margin-bottom: .8rem; }
  .search-bar input {
    font-size: .85rem; padding: .4rem .7rem; border: 1px solid var(--border);
    border-radius: 4px; width: 100%; max-width: 400px;
  }
  .count-label { font-size: .8rem; color: var(--muted); margin-left: .8rem; }

  footer {
    text-align: center; padding: 1.5rem; font-size: .8rem; color: var(--muted);
    border-top: 1px solid var(--border); margin-top: 2rem;
  }
</style>
</head>
<body>

<style>
  .site-nav {
    position: sticky; top: 0; z-index: 100;
    background: #212529; display: flex; align-items: center;
    padding: 0 2rem; height: 3rem;
  }
  .site-nav .nav-brand {
    color: #fff; text-decoration: none; font-weight: 600; font-size: 1rem;
    margin-right: auto;
  }
  .site-nav .nav-brand:hover { color: #e9ecef; }
  .site-nav .nav-link {
    color: #adb5bd; text-decoration: none; font-size: .85rem;
    padding: 0 .75rem; height: 3rem; display: flex; align-items: center;
    background: none; border: none; cursor: pointer; font-family: inherit;
  }
  .site-nav .nav-link:hover, .site-nav .nav-link.active { color: #fff; }
  .nav-dropdown { position: relative; }
  .dropdown-menu {
    display: none; position: absolute; top: 3rem; right: 0;
    background: #fff; border: 1px solid var(--border); border-radius: 6px;
    box-shadow: 0 4px 16px rgba(0,0,0,.12); min-width: 220px;
    padding: .4rem 0; z-index: 200; max-height: 80vh; overflow-y: auto;
  }
  .nav-dropdown.open .dropdown-menu { display: block; }
  .dropdown-menu a {
    display: block; padding: .3rem 1rem; color: #1a1a1a;
    text-decoration: none; font-size: .82rem;
  }
  .dropdown-menu a:hover { background: #f0f4f8; }
  .dropdown-group-label {
    padding: .4rem 1rem .15rem; font-size: .68rem; font-weight: 700;
    color: #888; text-transform: uppercase; letter-spacing: .04em;
  }
  .dropdown-divider { border-top: 1px solid #eee; margin: .3rem 0; }
  .page-header {
    padding: .8rem 2rem; border-bottom: 1px solid var(--border); background: #fff;
  }
  .page-header h1 { font-size: 1.3rem; font-weight: 600; }
  .page-header p { color: var(--muted); font-size: .85rem; margin-top: .15rem; }
</style>

<nav class="site-nav">
  <a href="../index.html" class="nav-brand">Corruption in Procurement</a>
  <a href="../index.html" class="nav-link">Home</a>
  <div class="nav-dropdown">
    <button class="nav-link">Docs &#9662;</button>
    <div class="dropdown-menu">
    <div class="dropdown-group-label">Reference</div>
    <a href="../docs/README.html">Project Overview</a>
    <a href="../docs/summary.html">Research Summary</a>
    <a href="../docs/institutions.html">Institutional Background</a>
    <a href="../docs/data.html">Data Sources</a>
    <a href="../docs/methods.html">Empirical Methods</a>
    <a href="../docs/literature.html">Literature</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Working notes</div>
    <a href="../docs/thinking.html">Open Questions & Ideas</a>
    <a href="../docs/decisions.html">Key Decisions</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Tasks</div>
    <a href="../docs/todo.html">Active Tasks</a>
    <a href="../docs/done.html">Completed Tasks</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Communication</div>
    <a href="../docs/meetings.html">Meeting Notes</a>
    <a href="../docs/feedback.html">External Feedback</a>
    <div class="dropdown-divider"></div>
    <div class="dropdown-group-label">Briefs</div>
    <a href="../briefs/linking.html">Linking Court Cases to Procurement Data</a>
    </div>
  </div>
  <div class="nav-dropdown">
    <button class="nav-link active">Data &#9662;</button>
    <div class="dropdown-menu">
    <a href="../sources/tjsp.html">TJSP Court Cases</a>
    <a href="../sources/bec.html">BEC Procurement</a>
    <a href="../sources/tce-sp-spending.html">TCE-SP Municipal Spending</a>
    <a href="../sources/tce-sp-procurement.html">TCE-SP Municipal Procurement</a>
    <a href="../sources/tce-sp-audits.html">TCE-SP Municipal Audits</a>
    </div>
  </div>
</nav>
<script>
document.querySelectorAll('.nav-dropdown > .nav-link').forEach(function(btn) {
  btn.addEventListener('click', function(e) {
    e.stopPropagation();
    var dd = btn.parentElement;
    var wasOpen = dd.classList.contains('open');
    document.querySelectorAll('.nav-dropdown.open').forEach(function(d) { d.classList.remove('open'); });
    if (!wasOpen) dd.classList.add('open');
  });
});
document.addEventListener('click', function() {
  document.querySelectorAll('.nav-dropdown.open').forEach(function(d) { d.classList.remove('open'); });
});
</script>

<div class="page-header">
  <h1>TCE-SP Fiscal Alerts</h1>
  <p>Automated fiscal alerts issued to SP municipalities by TCE-SP's monitoring system.</p>
</div>

<div class="stats-bar" id="stats-bar"></div>

<main>

<!-- Data source notes -->
<div id="source-notes-section"></div>

<!-- Column info -->
<h2 class="section-title">Column Information</h2>
<div class="card full">
  <div style="overflow-x:auto; max-height:400px; overflow-y:auto;">
    <table class="col-table" id="col-table"></table>
  </div>
</div>

<!-- Distribution charts -->
<div id="dist-section"></div>

<!-- Temporal charts -->
<div id="temporal-section"></div>

<!-- Sample data -->
<h2 class="section-title">Sample Data (50 rows)</h2>
<div class="card full">
  <div class="search-bar">
    <input type="text" id="search" placeholder="Search across all columns...">
    <span class="count-label" id="row-count"></span>
  </div>
  <div class="table-wrap">
    <table class="data-table">
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

</main>

<footer>
  Generated by <code>bash build.sh site</code>
</footer>

<script>
// Embedded data — replaced by build pipeline
const DATA = /* INJECT_DATA */ {"id":"tce-sp-alerts","name":"TCE-SP Fiscal Alerts","description":"Automated fiscal alerts issued to SP municipalities by TCE-SP's monitoring system.","category":"TCE-SP Audits","source_notes":"Analytical alerts generated by TCE-SP's automated fiscal monitoring system. Each row is an alert issued to a specific municipality and entity (entidade) for a particular analysis item (item de análise) in a given month. These alerts flag potential violations of fiscal responsibility rules.","file_size":1272577,"row_count":10431,"col_count":5,"columns":[{"name":"Exercício","dtype":"int64","null_count":0,"null_pct":0.0},{"name":"Mês","dtype":"int64","null_count":0,"null_pct":0.0},{"name":"Município","dtype":"object","null_count":0,"null_pct":0.0},{"name":"Entidade","dtype":"object","null_count":0,"null_pct":0.0},{"name":"Item de Análise","dtype":"object","null_count":0,"null_pct":0.0}],"categorical":{"Município":{"labels":["Diadema","Pirapora do Bom Jesus","Araçariguama","Presidente Venceslau","Barretos","Franco da Rocha","Macaubal","Cubatão","Registro","Taquarituba","São João do Pau d'Alho","Patrocínio Paulista","Promissão","Urânia","Ibirarema","Jandira","Magda","Ubatuba","Araras","Paulo de Faria"],"values":[34,32,31,31,30,29,29,28,28,27,27,27,27,27,27,27,26,26,26,26]},"Item de Análise":{"labels":["CI01 - Cumprimento das entregas da documentação exigida pelo TCE","AE05 - Aplicação de Recursos do FUNDEB","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada","GF15 - Análise da Receita (Execução Orçamentária)","AE06 - Aplicação de Recursos do FUNDEB na remuneração do Magistério","GF20 - Análise do Resultado Primário - LOA Atualizada X Meta da LDO","GF22 - RPPS - Previsão X Realização das Receitas Previdenciárias","AS03 - Aplicação de Recursos Próprios em Saúde com base na Despesa Liquidada","GF37 - Análise das despesas assumidas nos últimos quatro bimestres (Art. 42 da LRF)","GF27 - Despesas com Pessoal","GF16 - Análise da Despesa (Execução Orçamentária)","AE02 - Planejamento Atualizado de Aplicação em Ensino","GF26 - Análise dos Restos a Pagar - Movimentação até o Período","GF23 - RPPS - Análise das Disponibilidades Financeiras do Regime Previdenciário","GF53 - Limite Constitucional para gasto com Folha de Pagamento","AS02 - Planejamento Atualizado de Aplicação em Saúde","GF28 - Dívida Consolidada"],"values":[1978,1658,1517,1365,1200,843,480,333,239,200,176,172,154,66,36,13,1]}},"temporal":{"Exercício":{"min":"2019","max":"2019","by_year":{"labels":[2019],"values":[10431]}}},"sample_columns":["Exercício","Mês","Município","Entidade","Item de Análise"],"sample":[["2019","2","Bofete","PREFEITURA MUNICIPAL DE BOFETE","AE06 - Aplicação de Recursos do FUNDEB na remuneração do Magistério"],["2019","4","Alambari","PREFEITURA MUNICIPAL DE ALAMBARI","AE05 - Aplicação de Recursos do FUNDEB"],["2019","2","Itariri","PREFEITURA MUNICIPAL DE ITARIRI","AE05 - Aplicação de Recursos do FUNDEB"],["2019","4","Borá","PREFEITURA MUNICIPAL DE BORÁ","GF20 - Análise do Resultado Primário - LOA Atualizada X Meta da LDO"],["2019","2","Santa Rosa de Viterbo","PREFEITURA MUNICIPAL DE SANTA ROSA DE VITERBO","AE05 - Aplicação de Recursos do FUNDEB"],["2019","2","Araçariguama","PREFEITURA MUNICIPAL DE ARAÇARIGUAMA","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada"],["2019","4","Getulina","PREFEITURA MUNICIPAL DE GETULINA","GF15 - Análise da Receita (Execução Orçamentária)"],["2019","1","Ibitinga","PREFEITURA MUNICIPAL DA  ESTANCIA TURISTICA IBITINGA","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada"],["2019","4","Cunha","PREFEITURA MUNICIPAL DE CUNHA","CI01 - Cumprimento das entregas da documentação exigida pelo TCE"],["2019","1","Alfredo Marcondes","PREFEITURA MUNICIPAL DE ALFREDO MARCONDES","AE05 - Aplicação de Recursos do FUNDEB"],["2019","2","Espírito Santo do Turvo","PREFEITURA MUNICIPAL DE ESPÍRITO SANTO DO TURVO","AE05 - Aplicação de Recursos do FUNDEB"],["2019","3","Nova Odessa","PREFEITURA MUNICIPAL DE NOVA ODESSA","GF15 - Análise da Receita (Execução Orçamentária)"],["2019","2","Vargem Grande do Sul","PREFEITURA MUNICIPAL DE VARGEM GRANDE DO SUL","GF26 - Análise dos Restos a Pagar - Movimentação até o Período"],["2019","3","Jaboticabal","PREFEITURA MUNICIPAL DE JABOTICABAL","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada"],["2019","4","Buritama","PREFEITURA MUNICIPAL DE BURITAMA","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada"],["2019","2","São Pedro do Turvo","PREFEITURA MUNICIPAL DE SÃO PEDRO DO TURVO","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada"],["2019","4","Anhembi","PREFEITURA MUNICIPAL DE ANHEMBI","CI01 - Cumprimento das entregas da documentação exigida pelo TCE"],["2019","3","Itápolis","PREFEITURA MUNICIPAL DE ITÁPOLIS","GF15 - Análise da Receita (Execução Orçamentária)"],["2019","2","Lorena","PREFEITURA MUNICIPAL DE LORENA","GF15 - Análise da Receita (Execução Orçamentária)"],["2019","2","Ibaté","PREFEITURA MUNICIPAL DE IBATÉ","GF20 - Análise do Resultado Primário - LOA Atualizada X Meta da LDO"],["2019","1","Santa Gertrudes","PREFEITURA MUNICIPAL DE SANTA GERTRUDES","AE05 - Aplicação de Recursos do FUNDEB"],["2019","3","Jundiaí","PREFEITURA MUNICIPAL DE JUNDIAÍ","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada"],["2019","1","Guzolândia","PREFEITURA MUNICIPAL DE GUZOLÂNDIA","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada"],["2019","4","Lagoinha","PREFEITURA MUNICIPAL DE LAGOINHA","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada"],["2019","4","Manduri","PREFEITURA MUNICIPAL DE MANDURI","AE05 - Aplicação de Recursos do FUNDEB"],["2019","4","Ourinhos","CÂMARA MUNICIPAL DE OURINHOS","GF37 - Análise das despesas assumidas nos últimos quatro bimestres (Art. 42 da LRF)"],["2019","1","Nova Canaã Paulista","PREFEITURA MUNICIPAL DE NOVA CANAÃ PAULISTA","AE06 - Aplicação de Recursos do FUNDEB na remuneração do Magistério"],["2019","1","Alfredo Marcondes","PREFEITURA MUNICIPAL DE ALFREDO MARCONDES","CI01 - Cumprimento das entregas da documentação exigida pelo TCE"],["2019","2","Populina","PREFEITURA MUNICIPAL DE POPULINA","GF23 - RPPS - Análise das Disponibilidades Financeiras do Regime Previdenciário"],["2019","4","Nipoã","PREFEITURA MUNICIPAL DE NIPOÃ","GF20 - Análise do Resultado Primário - LOA Atualizada X Meta da LDO"],["2019","2","Diadema","PREFEITURA MUNICIPAL DE DIADEMA","GF20 - Análise do Resultado Primário - LOA Atualizada X Meta da LDO"],["2019","4","Álvaro de Carvalho","PREFEITURA MUNICIPAL DE ÁLVARO DE CARVALHO","AE05 - Aplicação de Recursos do FUNDEB"],["2019","4","Ibirá","PREFEITURA MUNICIPAL DE IBIRÁ","GF27 - Despesas com Pessoal"],["2019","2","Franca","PREFEITURA MUNICIPAL DE FRANCA","CI01 - Cumprimento das entregas da documentação exigida pelo TCE"],["2019","4","Macaubal","CÂMARA MUNICIPAL DE MACAUBAL","CI01 - Cumprimento das entregas da documentação exigida pelo TCE"],["2019","4","Ribeirão Preto","PREFEITURA MUNICIPAL DE RIBEIRÃO PRETO","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada"],["2019","4","Novais","PREFEITURA MUNICIPAL DE NOVAIS","GF15 - Análise da Receita (Execução Orçamentária)"],["2019","3","Ibitinga","PREFEITURA MUNICIPAL DA  ESTANCIA TURISTICA IBITINGA","AE06 - Aplicação de Recursos do FUNDEB na remuneração do Magistério"],["2019","3","Laranjal Paulista","PREFEITURA MUNICIPAL DE LARANJAL PAULISTA","GF15 - Análise da Receita (Execução Orçamentária)"],["2019","4","Boracéia","PREFEITURA MUNICIPAL DE BORACÉIA","CI01 - Cumprimento das entregas da documentação exigida pelo TCE"],["2019","2","Miracatu","PREFEITURA MUNICIPAL DE MIRACATU","AE06 - Aplicação de Recursos do FUNDEB na remuneração do Magistério"],["2019","4","Flórida Paulista","PREFEITURA MUNICIPAL DE FLÓRIDA PAULISTA","GF27 - Despesas com Pessoal"],["2019","1","Altair","PREFEITURA MUNICIPAL DE ALTAIR/SP","AE06 - Aplicação de Recursos do FUNDEB na remuneração do Magistério"],["2019","1","Dois Córregos","PREFEITURA MUNICIPAL DE DOIS CÓRREGOS","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada"],["2019","1","Araçariguama","PREFEITURA MUNICIPAL DE ARAÇARIGUAMA","AE06 - Aplicação de Recursos do FUNDEB na remuneração do Magistério"],["2019","4","Pereira Barreto","PREFEITURA MUNICIPAL DE PEREIRA BARRETO","AE03 - Aplicação de Recursos Próprios em Ensino com base na Despesa Liquidada"],["2019","1","Poloni","PREFEITURA MUNICIPAL DE POLONI","AE05 - Aplicação de Recursos do FUNDEB"],["2019","4","Itapevi","PREFEITURA MUNICIPAL DE ITAPEVI","CI01 - Cumprimento das entregas da documentação exigida pelo TCE"],["2019","4","Caraguatatuba","PREFEITURA MUNICIPAL DE CARAGUATATUBA","GF20 - Análise do Resultado Primário - LOA Atualizada X Meta da LDO"],["2019","4","Mombuca","PREFEITURA MUNICIPAL DE MOMBUCA","GF20 - Análise do Resultado Primário - LOA Atualizada X Meta da LDO"]]};

// Helpers
const pal = ['#0d6efd','#198754','#dc3545','#fd7e14','#6f42c1','#20c997',
             '#0dcaf0','#d63384','#ffc107','#6610f2','#adb5bd','#e85d04',
             '#2b9348','#4361ee','#f72585'];
function fmtNum(n) { return n.toLocaleString('en'); }
function fmtSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / 1048576).toFixed(1) + ' MB';
}

// Data source notes
(function() {
  if (!DATA.source_notes) return;
  const section = document.getElementById('source-notes-section');
  const h2 = document.createElement('h2');
  h2.className = 'section-title';
  h2.textContent = 'About This Dataset';
  section.appendChild(h2);
  const card = document.createElement('div');
  card.className = 'card full';
  card.innerHTML = '<p style="font-size:.9rem;line-height:1.7;color:#333">' + DATA.source_notes + '</p>';
  section.appendChild(card);
})();

// Stats bar
(function() {
  const bar = document.getElementById('stats-bar');
  const items = [
    ['Rows', fmtNum(DATA.row_count)],
    ['Columns', fmtNum(DATA.col_count)],
    ['File Size', fmtSize(DATA.file_size)],
  ];
  // Add temporal ranges
  Object.entries(DATA.temporal || {}).forEach(([col, t]) => {
    items.push(['Date Range (' + col + ')', t.min + ' to ' + t.max]);
  });
  items.forEach(([label, value]) => {
    const d = document.createElement('div');
    d.className = 'stat-card';
    d.innerHTML = '<div class="value">' + value + '</div><div class="label">' + label + '</div>';
    bar.appendChild(d);
  });
})();

// Column info table
(function() {
  const table = document.getElementById('col-table');
  let html = '<thead><tr><th>#</th><th>Column</th><th>Type</th><th>Nulls</th><th>Null %</th></tr></thead><tbody>';
  DATA.columns.forEach((c, i) => {
    const barW = Math.min(c.null_pct, 100);
    html += '<tr><td>' + (i + 1) + '</td><td><strong>' + c.name + '</strong></td>'
      + '<td>' + c.dtype + '</td>'
      + '<td>' + fmtNum(c.null_count) + '</td>'
      + '<td><span class="null-bar" style="width:' + barW + 'px"></span> ' + c.null_pct + '%</td></tr>';
  });
  html += '</tbody>';
  table.innerHTML = html;
})();

// Categorical distribution charts
(function() {
  const section = document.getElementById('dist-section');
  const cats = Object.entries(DATA.categorical || {});
  if (cats.length === 0) return;

  const h2 = document.createElement('h2');
  h2.className = 'section-title';
  h2.textContent = 'Categorical Distributions (Top 15)';
  section.appendChild(h2);

  const grid = document.createElement('div');
  grid.className = 'grid';
  section.appendChild(grid);

  cats.forEach(([col, d], idx) => {
    const card = document.createElement('div');
    card.className = 'card';
    const labels = d.labels.map(s => String(s).length > 40 ? String(s).slice(0, 38) + '\u2026' : String(s));
    card.innerHTML = '<h3>' + col + '</h3><div class="chart-wrap hbar"><canvas id="cat-' + idx + '"></canvas></div>';
    grid.appendChild(card);

    // Render after DOM insertion
    setTimeout(() => {
      new Chart(document.getElementById('cat-' + idx), {
        type: 'bar',
        data: { labels: labels, datasets: [{ data: d.values, backgroundColor: pal[idx % pal.length] }] },
        options: {
          indexAxis: 'y', responsive: true, maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { x: { beginAtZero: true } }
        }
      });
    }, 0);
  });
})();

// Temporal charts
(function() {
  const section = document.getElementById('temporal-section');
  const temps = Object.entries(DATA.temporal || {});
  if (temps.length === 0) return;

  const h2 = document.createElement('h2');
  h2.className = 'section-title';
  h2.textContent = 'Temporal Distribution';
  section.appendChild(h2);

  const grid = document.createElement('div');
  grid.className = 'grid';
  section.appendChild(grid);

  temps.forEach(([col, t], idx) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = '<h3>' + col + ' by year</h3><div class="chart-wrap bar"><canvas id="temp-' + idx + '"></canvas></div>';
    grid.appendChild(card);

    setTimeout(() => {
      new Chart(document.getElementById('temp-' + idx), {
        type: 'bar',
        data: {
          labels: t.by_year.labels,
          datasets: [{ label: 'Count', data: t.by_year.values, backgroundColor: '#0d6efd' }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }, 0);
  });
})();

// Sample data table
const allRows = DATA.sample || [];
const sampleCols = DATA.sample_columns || [];

(function() {
  document.getElementById('thead').innerHTML = '<tr>' + sampleCols.map(c => '<th>' + c + '</th>').join('') + '</tr>';
  const searchEl = document.getElementById('search');
  const countEl = document.getElementById('row-count');
  const tbody = document.getElementById('tbody');

  function render() {
    const q = searchEl.value.toLowerCase();
    const rows = q ? allRows.filter(r => r.some(v => String(v).toLowerCase().includes(q))) : allRows;
    tbody.innerHTML = rows.map(r =>
      '<tr>' + r.map(v => '<td>' + v + '</td>').join('') + '</tr>'
    ).join('');
    countEl.textContent = rows.length + ' of ' + allRows.length + ' rows';
  }
  searchEl.addEventListener('input', render);
  render();
})();
</script>
</body>
</html>
